<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Электронный журнал</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');

  body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    margin: 0;
    padding: 0;
    color: #fff;
  }

  /* Общий стиль контейнера */
  .container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 20px;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  /* Анимация скрытия/показу */
  .fade-hidden {
    opacity: 0;
    transform: translateY(-20px);
    pointer-events: none;
    visibility: hidden;
  }

  /* Заголовки */
  h2 {
    margin: 0;
  }

  /* Таблица */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    backdrop-filter: blur(4px);
  }
  th, td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.3);
  }
  th {
    background: rgba(255,255,255,0.2);
    font-weight: 600;
  }

  /* Формы и кнопки */
  .form-group {
    display: flex;
    flex-direction: column;
    margin: 10px 0;
  }

  input {
    padding: 12px;
    margin: 8px 0;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(4px);
    outline: none;
    color: #fff;
    transition: background 0.3s ease;
  }
  input:focus {
    background: rgba(255,255,255,0.3);
  }

  button {
    padding: 12px;
    margin-top: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
  }

  /* Цветовые стили для кнопок */
  .btn-primary {
    background: linear-gradient(45deg, #a445b2, #fa4299);
    color: #fff;
  }
  .btn-primary:hover {
    background: linear-gradient(45deg, #fa4299, #a445b2);
  }

  .btn-secondary {
    background: rgba(255,255,255,0.2);
    color: #fff;
  }
  .btn-secondary:hover {
    background: rgba(255,255,255,0.4);
  }

  /* Для скрытых элементов */
  .hidden {
    display: none;
  }

  /* Для анимации появления/исчезновения */
  .fade-in {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }
  .fade-out {
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  /* Для редактируемых ячеек (для учителя) */
  .editable {
    background: rgba(255,255,255,0.1);
  }
</style>
</head>
<body>

<!-- Вход и регистрация -->
<div id="auth-section" class="container" style="max-width:350px; margin:auto; margin-top:50px;">
  <h3 style="text-align:center;">Регистрация / Вход</h3>
  <div style="display:flex; justify-content:space-around; margin-bottom:15px;">
    <button class="btn-secondary" onclick="showAuthMode('login')">Войти</button>
    <button class="btn-secondary" onclick="showAuthMode('register')">Регистрация</button>
  </div>
  <div id="auth-form">
    <div class="form-group">
      <input type="text" id="auth-login" placeholder="Логин" />
    </div>
    <div class="form-group">
      <input type="password" id="auth-password" placeholder="Пароль" />
    </div>
    <div class="form-group" id="role-selection" style="margin-top:10px;">
      <label><input type="radio" name="role" value="student" checked> Учень</label>
      <label style="margin-left:10px;"><input type="radio" name="role" value="teacher"> Учитель</label>
    </div>
    <button class="btn-primary" id="auth-submit-btn" onclick="submitAuth()">Подтвердить</button>
    <p style="text-align:center; margin-top:10px;" id="auth-message"></p>
  </div>
</div>

<!-- Остальной интерфейс остается без изменений -->

<!-- Вход учеников -->
<div id="student-login-section" class="container hidden">
  <h3>Вход как ученик</h3>
  <div class="form-group">
    <input type="text" id="student-username" placeholder="Имя ученика" />
  </div>
  <div class="form-group">
    <input type="password" id="student-password" placeholder="Пароль" />
  </div>
  <button class="btn-primary" onclick="studentLogin()">Войти</button>
  <p style="text-align:center; margin-top:10px;"><button class="btn-secondary" onclick="showEntry()">Назад</button></p>
</div>

<!-- Вход учителя -->
<div id="teacher-login-section" class="container hidden">
  <h3>Вход как учитель</h3>
  <div class="form-group">
    <input type="text" id="teacher-username" placeholder="Логин учителя" />
  </div>
  <div class="form-group">
    <input type="password" id="teacher-password" placeholder="Пароль" />
  </div>
  <button class="btn-primary" onclick="teacherLogin()">Войти</button>
  <p style="text-align:center; margin-top:10px;"><button class="btn-secondary" onclick="showEntry()">Назад</button></p>
</div>

<!-- Создание класса (для учителя) -->
<div id="class-section" class="container hidden">
  <h3>Создать класс</h3>
  <div class="form-group">
    <input type="text" id="className" placeholder="Название класса" />
  </div>
  <button class="btn-primary" onclick="createClass()">Создать</button>
</div>

<!-- Основной раздел для учителя -->
<div id="teacher-section" class="container hidden">
  <h1 id="teacher-class-title">Класс: </h1>
  <button class="btn-secondary" style="margin-bottom:15px;" onclick="showAddStudent()">Добавить ученика</button>
  <!-- Форма добавления ученика -->
  <div id="add-student-form" class="hidden" style="margin-bottom:15px;">
    <div class="form-group">
      <input type="text" id="studentName" placeholder="Имя ученика" />
    </div>
    <div class="form-group">
      <input type="text" id="studentPassword" placeholder="Пароль" />
    </div>
    <button class="btn-primary" onclick="addStudent()">Добавить</button>
  </div>

  <!-- Таблица учеников -->
  <table id="students-table" style="width:100%; margin-top:10px; backdrop-filter: blur(4px); background: rgba(255,255,255,0.2); border-radius:8px;">
    <thead>
      <tr>
        <th>Имя</th>
        <th>Пароль</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Создание класса (только для учителя) -->
  <div style="margin-top:20px;">
    <button class="btn-primary" onclick="showCreateClass()">Создать класс</button>
  </div>
  <div id="create-class-div" class="hidden" style="margin-top:10px;">
    <div class="form-group">
      <input type="text" id="newClassName" placeholder="Название нового класса" />
    </div>
    <button class="btn-primary" onclick="saveNewClass()">Создать класс</button>
  </div>

  <!-- Выбор класса для учителя -->
  <h3 style="margin-top:20px;">Выберите класс</h3>
  <div id="class-list"></div>

  <!-- Дневник -->
  <h2 style="margin-top:30px;">Дневник</h2>
  <table id="journal">
    <thead>
      <tr>
        <th>Предмет</th>
        <th>Студент</th>
        <th>Оценка</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="btn-primary" style="margin-top:15px;" onclick="saveGrades()">Сохранить оценки</button>

  <!-- Домашнее задание -->
  <h2 style="margin-top:30px;">Домашние задания</h2>
  <div>
    <ul id="homework-list"></ul>
  </div>
  <div style="margin-top:10px;">
    <input type="text" id="new-homework" placeholder="Новое задание" style="width:70%; padding:8px; border-radius:8px; border:none;"/>
    <button class="btn-primary" onclick="addHomework()">Добавить</button>
  </div>
</div>

<!-- Страница ученика -->
<div id="student-section" class="container hidden">
  <h1 id="student-name-heading">Ученик: </h1>
  <h2>Домашние задания</h2>
  <ul id="student-homework"></ul>
  <h2>Мои оценки</h2>
  <table id="student-grades">
    <thead>
      <tr>
        <th>Предмет</th>
        <th>Оценка</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="btn-secondary" style="margin-top:20px;" onclick="showEntry()">Выйти</button>
</div>

<script>
const subjects = ["Математика", "Русский язык", "География", "Информатика", "Английский", "Биология", "История", "Физкультура"];

let currentUser = null; // Объект текущего пользователя
let currentRole = null; // 'student' или 'teacher'

// Загружаем классы из localStorage
let classes = JSON.parse(localStorage.getItem('classes')) || {};

// Для хранения текущего режима авторизации
let authMode = 'login'; // или 'register'

// Показать форму авторизации/регистрации
function showAuthMode(mode) {
  authMode = mode;
  document.getElementById('auth-message').innerText = '';
  document.getElementById('auth-login').value = '';
  document.getElementById('auth-password').value = '';
  document.querySelectorAll('#role-selection input').forEach(r => r.checked = true);
  document.getElementById('auth-submit-btn').innerText = mode === 'login' ? 'Войти' : 'Зарегистрироваться';
}

// Обработка подтверждения
function submitAuth() {
  const login = document.getElementById('auth-login').value.trim();
  const password = document.getElementById('auth-password').value.trim();
  const role = document.querySelector('#role-selection input[name="role"]:checked').value;

  if (!login || !password) {
    document.getElementById('auth-message').innerText = 'Заполните все поля.';
    return;
  }

  if (authMode === 'register') {
    // Регистрация
    if (localStorage.getItem('user_' + login)) {
      document.getElementById('auth-message').innerText = 'Этот логин уже занят.';
      return;
    }
    // Создаем пользователя
    localStorage.setItem('user_' + login, JSON.stringify({ password, role, class: role === 'teacher' ? null : '' }));
    alert('Регистрация прошла успешно! Войдите в систему.');
    showAuthMode('login');
  } else {
    // Вход
    const userData = JSON.parse(localStorage.getItem('user_' + login));
    if (userData && userData.password === password) {
      currentUser = { username: login, ...userData };
      currentRole = userData.role;
      showEntry();
      if (currentRole === 'student') {
        loadStudentData();
        showSection('student-section');
      } else if (currentRole === 'teacher') {
        loadTeacherData();
        showSection('teacher-section');
      }
    } else {
      document.getElementById('auth-message').innerText = 'Неверный логин или пароль.';
    }
  }
}

// Вход как ученик
function studentLogin() {
  const username = document.getElementById('student-username').value.trim();
  const password = document.getElementById('student-password').value.trim();

  if (!username || !password) {
    alert('Введите логин и пароль.');
    return;
  }

  const userData = JSON.parse(localStorage.getItem('user_' + username));
  if (userData && userData.role === 'student' && userData.password === password) {
    currentUser = { username, ...userData };
    currentRole = 'student';
    loadStudentData();
    showSection('student-section');
  } else {
    alert('Неверные логин или пароль.');
  }
}

// Вход как учитель
function teacherLogin() {
  const username = document.getElementById('teacher-username').value.trim();
  const password = document.getElementById('teacher-password').value.trim();

  if (!username || !password) {
    alert('Введите логин и пароль.');
    return;
  }

  const userData = JSON.parse(localStorage.getItem('user_' + username));
  if (userData && userData.role === 'teacher' && userData.password === password) {
    currentUser = { username, ...userData };
    currentRole = 'teacher';
    loadTeacherData();
    showSection('teacher-section');
  } else {
    alert('Неверные логин или пароль.');
  }
}

// Показываем страницу входа/регистрации
function showEntry() {
  document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
  showSection('auth-section');
}

// Создать класс (только для учителя)
function createClass() {
  const className = document.getElementById('className').value.trim();
  if (!className) {
    alert('Введите название класса.');
    return;
  }
  if (classes[className]) {
    alert('Этот класс уже существует.');
    return;
  }
  classes[className] = { students: [], grades: [], homework: [] };
  localStorage.setItem('classes', JSON.stringify(classes));
  alert('Класс создан! Теперь выберите его для работы.');
  document.getElementById('className').value = '';
  showClassList();
}

// Загрузка данных для учителя
function loadTeacherData() {
  const className = currentUser.class;
  document.getElementById('teacher-class-title').innerText = 'Класс: ' + className;
  loadClassInfo();
  showClassList();
  loadGrades();
  loadHomework();
}

// Показываем список классов для выбора
function showClassList() {
  const container = document.getElementById('class-list');
  container.innerHTML = '';
  for (let className in classes) {
    const btn = document.createElement('button');
    btn.innerText = className;
    btn.className = 'btn-primary';
    btn.style = 'margin:5px;';
    btn.onclick = () => {
      currentUser.class = className;
      loadTeacherData();
    };
    container.appendChild(btn);
  }
}

// Загрузка информации о классе
function loadClassInfo() {
  const classData = classes[currentUser.class];
  if (!classData) return;

  // Загрузка учеников
  const tbody = document.querySelector('#students-table tbody');
  tbody.innerHTML = '';
  classData.students.forEach(s => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${s.name}</td><td>${s.password}</td>`;
    tbody.appendChild(row);
  });
}

// Создать и редактировать оценки
function loadGrades() {
  const classData = classes[currentUser.class];
  const tbody = document.querySelector('#journal tbody');
  tbody.innerHTML = '';

  if (!classData || !classData.grades) return;

  classData.grades.forEach(g => {
    const isEditable = currentUser.role === 'teacher';
    const inputAttrs = isEditable ? '' : 'disabled';
    const inputClass = isEditable ? '' : 'editable';
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${g.subject}</td>
      <td>${g.student}</td>
      <td><input type="number" min="0" max="100" value="${g.grade}" ${inputAttrs} class="${inputClass}"/></td>
    `;
    tbody.appendChild(row);
  });
}

// Сохранить оценки
function saveGrades() {
  if (currentUser.role !== 'teacher') {
    alert('Только учитель может сохранять оценки.');
    return;
  }
  const tbody = document.querySelector('#journal tbody');
  const rows = Array.from(tbody.rows);
  try {
    const grades = rows.map(row => {
      const cells = row.cells;
      const subject = cells[0].innerText;
      const student = cells[1].innerText;
      const gradeVal = parseInt(cells[2].querySelector('input').value);
      if (isNaN(gradeVal) || gradeVal < 0 || gradeVal > 100) {
        alert('Оценка должна быть числом от 0 до 100.');
        throw new Error('Некорректная оценка');
      }
      return { subject, student, grade: gradeVal };
    });
    const classData = classes[currentUser.class];
    classData.grades = grades;
    localStorage.setItem('classes', JSON.stringify(classes));
    alert('Оценки сохранены!');
  } catch(e) {
    // Ошибка уже показана
  }
}

// Добавление ученика
function showAddStudent() {
  document.getElementById('add-student-form').classList.toggle('hidden');
}

function addStudent() {
  const name = document.getElementById('studentName').value.trim();
  const password = document.getElementById('studentPassword').value.trim();
  if (!name || !password) {
    alert('Заполните все поля.');
    return;
  }
  const classData = classes[currentUser.class];
  if (classData.students.some(s => s.name === name)) {
    alert('Такой ученик уже есть.');
    return;
  }
  classData.students.push({ name, password });
  localStorage.setItem('classes', JSON.stringify(classes));
  document.getElementById('studentName').value = '';
  document.getElementById('studentPassword').value = '';
  document.getElementById('add-student-form').classList.add('hidden');
  loadClassInfo();
}

// Загрузка домашних заданий
function loadHomework() {
  const classData = classes[currentUser.class];
  const list = document.getElementById('homework-list');
  list.innerHTML = '';
  if (!classData || !classData.homework) return;
  classData.homework.forEach(task => {
    const li = document.createElement('li');
    li.innerText = task;
    list.appendChild(li);
  });
}

// Добавить домашнее задание
function addHomework() {
  const task = document.getElementById('new-homework').value.trim();
  if (!task) return;
  const classData = classes[currentUser.class];
  if (!classData.homework) classData.homework = [];
  classData.homework.push(task);
  localStorage.setItem('classes', JSON.stringify(classes));
  document.getElementById('new-homework').value = '';
  loadHomework();
}

// Для ученика: загрузка данных
function loadStudentData() {
  document.getElementById('student-name-heading').innerText = 'Ученик: ' + currentUser.username;
  loadStudentGrades();
  loadStudentHomework();
}

function loadStudentGrades() {
  const classData = classes[currentUser.class];
  const tbody = document.querySelector('#student-grades tbody');
  tbody.innerHTML = '';
  if (!classData || !classData.grades) return;
  const studentGrades = classData.grades.filter(g => g.student === currentUser.username);
  studentGrades.forEach(g => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${g.subject}</td><td>${g.grade}</td>`;
    tbody.appendChild(row);
  });
}

function loadStudentHomework() {
  const classData = classes[currentUser.class];
  const list = document.getElementById('student-homework');
  list.innerHTML = '';
  if (!classData || !classData.homework) return;
  classData.homework.forEach(task => {
    const li = document.createElement('li');
    li.innerText = task;
    list.appendChild(li);
  });
}

// Показываем страницу входа/регистрации
function showEntry() {
  document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
  showSection('auth-section');
}

// Вызовем по умолчанию окно входа
showAuthMode('login');

</script>
</body>
</html>
